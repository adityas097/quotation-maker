import{c as H,A as o,j as e,a as K,F as Q}from"./index-C5bGCW4r.js";import{b as n}from"./vendor-hBbQJCfh.js";import{a as h}from"./authFetch-CQWmCeCA.js";import{M as V}from"./Modal-Ba9AK1t8.js";import{S as X,D as Y,U as Z,I as ee,u as y,w as se}from"./ImportWizard-D9Cmh7YE.js";import{u as te,P as ae}from"./PaginationControls-7gw_ikq3.js";import{T as v}from"./trash-2-BCfEatWq.js";import{P as ne}from"./plus-BroQ0DqQ.js";import{S as le}from"./square-pen-CUClBDmr.js";import{M as re}from"./map-pin-BVtU232o.js";import"./arrow-right-C6yyuN8B.js";const ie=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],oe=H("phone",ie),be=()=>{const[f,k]=n.useState([]),[p,b]=n.useState([]),[m,E]=n.useState(""),[I,C]=n.useState(!1),[P,d]=n.useState(!1),[u,j]=n.useState(null),[z,g]=n.useState(!1),[r,x]=n.useState(new Set),[a,i]=n.useState({name:"",email:"",phone:"",address:"",gstin:""}),{currentPage:T,totalPages:A,pageSize:D,totalItems:L,currentItems:S,goToPage:w,changePageSize:O}=te(p),F=[{label:"Client Name",key:"name",required:!0},{label:"Email",key:"email"},{label:"Phone",key:"phone"},{label:"Address",key:"address"},{label:"GSTIN",key:"gstin"}];n.useEffect(()=>{c()},[]),n.useEffect(()=>{const s=m.toLowerCase(),t=f.filter(l=>l.name.toLowerCase().includes(s)||l.email&&l.email.toLowerCase().includes(s)||l.phone&&l.phone.includes(m));b(t),w(1)},[m,f]);const c=async()=>{try{C(!0);const s=await h(`${o}/api/clients`);if(!s.ok)throw new Error("Failed to fetch clients");const t=await s.json(),l=Array.isArray(t)?t:[];k(l),b(l)}catch(s){console.error(s)}finally{C(!1)}},_=async s=>{s.preventDefault();try{const t=u?`${o}/api/clients/${u.id}`:`${o}/api/clients`,N=await h(t,{method:u?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(N.ok)d(!1),j(null),i({name:"",email:"",phone:"",address:"",gstin:""}),c();else{const R=await N.json();alert(`Error: ${R.error||"Unknown error"}`)}}catch(t){console.error(t),alert(`Failed to save client: ${t.message}`)}},$=async s=>{if(window.confirm("Are you sure you want to delete this client?"))try{(await h(`${o}/api/clients/${s}`,{method:"DELETE"})).ok&&c()}catch(t){console.error(t)}},M=async()=>{if(window.confirm(`Delete ${r.size} clients?`))try{(await h(`${o}/api/clients/bulk`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:Array.from(r)})})).ok&&(x(new Set),c())}catch(s){console.error(s)}},W=async s=>{try{(await h(`${o}/api/clients/bulk`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok?(g(!1),c(),alert("Bulk processing complete")):alert("Import failed")}catch(t){console.error(t),alert("Error during import")}},B=()=>{const s=y.json_to_sheet(f),t=y.book_new();y.book_append_sheet(t,s,"Clients"),se(t,"Clients_Export.xlsx")},U=s=>{const t=new Set(r);t.has(s)?t.delete(s):t.add(s),x(t)},G=s=>{s.target.checked?x(new Set(p.map(t=>t.id))):x(new Set)},q=s=>{j(s),i({name:s.name,email:s.email||"",phone:s.phone||"",address:s.address||"",gstin:s.gstin||""}),d(!0)},J=()=>{j(null),i({name:"",email:"",phone:"",address:"",gstin:""}),d(!0)};return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex-between mb-6",style:{flexWrap:"wrap",gap:"1rem"},children:[e.jsx("h2",{children:"Client Master"}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[e.jsxs("div",{className:"search-bar",style:{display:"flex",alignItems:"center",background:"#f3f4f6",padding:"0.5rem 1rem",borderRadius:"0.5rem"},children:[e.jsx(X,{size:18,color:"#6b7280"}),e.jsx("input",{style:{border:"none",background:"transparent",marginLeft:"0.5rem",outline:"none"},placeholder:"Search clients...",value:m,onChange:s=>E(s.target.value)})]}),r.size>0&&e.jsxs("button",{className:"btn",style:{background:"#fee2e2",color:"#ef4444"},onClick:M,children:[e.jsx(v,{size:16})," Delete (",r.size,")"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:B,children:[e.jsx(Y,{size:16})," Export"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:()=>g(!0),children:[e.jsx(Z,{size:16})," Bulk Import"]}),e.jsxs("button",{className:"btn btn-primary",onClick:J,children:[e.jsx(ne,{size:16})," Add Client"]})]})]}),e.jsx("div",{className:"table-container",children:I?e.jsx("p",{children:"Loading clients..."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40px"},children:e.jsx("input",{type:"checkbox",onChange:G,checked:p.length>0&&r.size===p.length})}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"GSTIN"}),e.jsx("th",{children:"Address"}),e.jsx("th",{style:{textAlign:"center"},children:"Actions"})]})}),e.jsxs("tbody",{children:[S.map(s=>e.jsxs("tr",{className:r.has(s.id)?"selected-row":"",children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:r.has(s.id),onChange:()=>U(s.id)})}),e.jsx("td",{style:{fontWeight:500},children:s.name}),e.jsx("td",{children:s.phone||"-"}),e.jsx("td",{children:s.gstin||"-"}),e.jsx("td",{style:{maxWidth:"300px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:s.address,children:s.address||"-"}),e.jsxs("td",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:[e.jsx("button",{className:"icon-btn",onClick:()=>q(s),title:"Edit",children:e.jsx(le,{size:16,color:"var(--primary-color)"})}),e.jsx("button",{className:"icon-btn",onClick:()=>$(s.id),title:"Delete",children:e.jsx(v,{size:16,color:"#ef4444"})})]})]},s.id)),S.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",style:{textAlign:"center",padding:"2rem"},children:"No clients found"})})]})]}),e.jsx(ae,{currentPage:T,totalPages:A,pageSize:D,totalItems:L,onPageChange:w,onPageSizeChange:O})]})}),e.jsx(V,{isOpen:P,onClose:()=>d(!1),title:u?"Edit Client":"Add New Client",children:e.jsxs("form",{onSubmit:_,className:"form-grid",children:[e.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Client Name *"}),e.jsxs("div",{className:"input-group",children:[e.jsx(K,{size:18,color:"#9ca3af"}),e.jsx("input",{className:"input-field",required:!0,value:a.name,onChange:s=>i({...a,name:s.target.value}),placeholder:"Enter client name"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Phone"}),e.jsxs("div",{className:"input-group",children:[e.jsx(oe,{size:18,color:"#9ca3af"}),e.jsx("input",{className:"input-field",value:a.phone,onChange:s=>i({...a,phone:s.target.value}),placeholder:"Phone number"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"GSTIN"}),e.jsxs("div",{className:"input-group",children:[e.jsx(Q,{size:18,color:"#9ca3af"}),e.jsx("input",{className:"input-field",value:a.gstin,onChange:s=>i({...a,gstin:s.target.value}),placeholder:"GST Number"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{type:"email",className:"input",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"Email address (optional)",style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Address"}),e.jsxs("div",{className:"input-group",style:{alignItems:"flex-start"},children:[e.jsx(re,{size:18,color:"#9ca3af",style:{marginTop:"0.5rem"}}),e.jsx("textarea",{className:"input-field",rows:"3",value:a.address,onChange:s=>i({...a,address:s.target.value}),placeholder:"Full billing address"})]})]})]}),e.jsxs("div",{className:"modal-footer",style:{marginTop:"1.5rem",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Client"})]})]})}),e.jsx(ee,{isOpen:z,onClose:()=>g(!1),onImport:W,fieldConfig:F,title:"Bulk Import Clients"})]})};export{be as default};
