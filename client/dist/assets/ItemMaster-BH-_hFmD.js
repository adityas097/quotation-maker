import{A as d,j as e}from"./index-Dp9SiYe_.js";import{b as a}from"./vendor-hBbQJCfh.js";import{a as c}from"./authFetch-CQWmCeCA.js";import{M as $}from"./Modal-BtkKWWgx.js";import{S as F,D as J,U as q,I as H,u as y,w as U}from"./ImportWizard-B-yK7RkS.js";import{u as G,P as K}from"./PaginationControls-DK-cWpwm.js";import{T as S}from"./trash-2-DHbAu9So.js";import{P as Q}from"./plus-D5jLMkYE.js";import"./arrow-right-DM-HL-hc.js";const re=()=>{const[x,v]=a.useState([]),[m,f]=a.useState([]),[u,C]=a.useState(""),[b,g]=a.useState(!1),[I,h]=a.useState(!1),[N,j]=a.useState(!1),[n,o]=a.useState({model_number:"",name:"",description:"",rate:"",hsn_code:"",tax_rate:""}),[r,p]=a.useState(new Set),{currentPage:_,totalPages:E,pageSize:T,totalItems:z,currentItems:w,goToPage:k,changePageSize:A}=G(m),D=[{label:"Model Number",key:"model_number",required:!1},{label:"Item Name",key:"name",required:!0},{label:"Description",key:"description"},{label:"Rate",key:"rate",type:"number"},{label:"HSN Code",key:"hsn_code"},{label:"Tax Rate (%)",key:"tax_rate",type:"number"}];a.useEffect(()=>{i()},[]),a.useEffect(()=>{const t=u.toLowerCase(),s=x.filter(l=>l.name.toLowerCase().includes(t)||l.model_number&&l.model_number.toLowerCase().includes(t)||l.description&&l.description.toLowerCase().includes(t));f(s),k(1)},[u,x]);const i=async()=>{try{g(!0);const t=await c(`${d}/api/items`);if(!t.ok)throw new Error("Failed to fetch items");const s=await t.json(),l=Array.isArray(s)?s:[];v(l),f(l)}catch(t){console.error(t)}finally{g(!1)}},P=async t=>{t.preventDefault();try{(await c(`${d}/api/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok&&(h(!1),o({model_number:"",name:"",description:"",rate:"",hsn_code:"",tax_rate:""}),i())}catch(s){console.error(s)}},B=async t=>{try{(await c(`${d}/api/items/bulk`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?(j(!1),i(),alert("Bulk processing complete")):alert("Import failed")}catch(s){console.error(s),alert("Error during import")}},O=async t=>{if(window.confirm("Are you sure you want to delete this item?"))try{(await c(`${d}/api/items/bulk`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:[t]})})).ok&&i()}catch(s){console.error(s)}},L=async()=>{if(window.confirm(`Delete ${r.size} items?`))try{(await c(`${d}/api/items/bulk`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:Array.from(r)})})).ok&&(p(new Set),i())}catch(t){console.error(t)}},M=()=>{const t=y.json_to_sheet(x),s=y.book_new();y.book_append_sheet(s,t,"Items"),U(s,"Items_Export.xlsx")},R=t=>{const s=new Set(r);s.has(t)?s.delete(t):s.add(t),p(s)},W=t=>{t.target.checked?p(new Set(m.map(s=>s.id))):p(new Set)};return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex-between",style:{marginBottom:"1.5rem",flexWrap:"wrap",gap:"1rem"},children:[e.jsx("h2",{children:"Item Master"}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[e.jsxs("div",{className:"search-bar",style:{display:"flex",alignItems:"center",background:"#f3f4f6",padding:"0.5rem 1rem",borderRadius:"0.5rem"},children:[e.jsx(F,{size:18,color:"#6b7280"}),e.jsx("input",{style:{border:"none",background:"transparent",marginLeft:"0.5rem",outline:"none"},placeholder:"Search...",value:u,onChange:t=>C(t.target.value)})]}),r.size>0&&e.jsxs("button",{className:"btn",style:{background:"#fee2e2",color:"#ef4444"},onClick:L,children:[e.jsx(S,{size:16})," Delete (",r.size,")"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:M,children:[e.jsx(J,{size:16})," Export"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:()=>j(!0),children:[e.jsx(q,{size:16})," Bulk Import/Edit"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>h(!0),children:[e.jsx(Q,{size:16})," Add Item"]})]})]}),e.jsxs("div",{className:"table-container",children:[b?e.jsx("p",{children:"Loading items..."}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40px"},children:e.jsx("input",{type:"checkbox",onChange:W,checked:m.length>0&&r.size===m.length})}),e.jsx("th",{children:"Model"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Rate"}),e.jsx("th",{children:"Tax %"}),e.jsx("th",{children:"HSN"}),e.jsx("th",{style:{textAlign:"center"},children:"Actions"})]})}),e.jsxs("tbody",{children:[w.map(t=>e.jsxs("tr",{className:r.has(t.id)?"selected-row":"",children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:r.has(t.id),onChange:()=>R(t.id)})}),e.jsx("td",{children:t.model_number||"-"}),e.jsx("td",{style:{fontWeight:500},children:t.name}),e.jsx("td",{style:{maxWidth:"200px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:t.description,children:t.description||"-"}),e.jsxs("td",{children:["â‚¹",t.rate]}),e.jsxs("td",{children:[t.tax_rate,"%"]}),e.jsx("td",{children:t.hsn_code||"-"}),e.jsx("td",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:e.jsx("button",{className:"icon-btn",title:"Delete",onClick:()=>O(t.id),children:e.jsx(S,{size:16,color:"#ef4444"})})})]},t.id)),w.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:"2rem"},children:"No items found"})})]})]}),!b&&e.jsx(K,{currentPage:_,totalPages:E,pageSize:T,totalItems:z,onPageChange:k,onPageSizeChange:A})]}),e.jsx($,{isOpen:I,onClose:()=>h(!1),title:"Add New Item",children:e.jsxs("form",{onSubmit:P,style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Model Number"}),e.jsx("input",{className:"input",value:n.model_number,onChange:t=>o({...n,model_number:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"HSN Code"}),e.jsx("input",{className:"input",value:n.hsn_code,onChange:t=>o({...n,hsn_code:t.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Item Name *"}),e.jsx("input",{className:"input",required:!0,value:n.name,onChange:t=>o({...n,name:t.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Rate"}),e.jsx("input",{type:"number",className:"input",value:n.rate,onChange:t=>o({...n,rate:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Tax Rate (%)"}),e.jsxs("select",{className:"input",value:n.tax_rate,onChange:t=>o({...n,tax_rate:t.target.value}),children:[e.jsx("option",{value:"0",children:"0%"}),e.jsx("option",{value:"5",children:"5%"}),e.jsx("option",{value:"12",children:"12%"}),e.jsx("option",{value:"18",children:"18%"}),e.jsx("option",{value:"28",children:"28%"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Description"}),e.jsx("textarea",{className:"input",rows:"3",value:n.description,onChange:t=>o({...n,description:t.target.value})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>h(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Item"})]})]})}),e.jsx(H,{isOpen:N,onClose:()=>j(!1),onImport:B,fieldConfig:D,title:"Bulk Import Items"})]})};export{re as default};
